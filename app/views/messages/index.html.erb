
<h1>Post a Message</h1>
<textarea id="message_content" placeholder="Type your message here..." rows="4"></textarea>
<button id="post_message_button">Post Message</button>

<h1>My Messages</h1>
<table id="messages_table">
  <thead>
    <tr>
      <th>Sl. No.</th>
      <th>Content</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <% @messages.each_with_index do |message, index| %>
      <tr id="message_<%= message.id %>">
        <td><%= index + 1 %></td>
        <td><%= message.content %></td>
        <td>
          <button class="delete-button" data-message-id="<%= message.id %>">Delete</button>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<style type="text/css">
  h1{
    text-align: center;
  }
  .message {
    display: flex;
    align-items: center; /* Align items vertically in the center */
  }

  .show-link {
    margin-right: 10px;
  }

  .delete-button {
    margin-left: 10px;
  }
</style>

<script type="text/javascript">
  $(document).ready(function() {
    // Post Message Button
    $('#post_message_button').click(function() {
      $.ajax({
        url: '/messages',
        method: 'POST',
        headers: {
          'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
        },
        data: { message: { content: $('#message_content').val() } },
        dataType: 'json',
        success: function(response) {
          $('#message_content').val('');
          console.log(response);
          appendMessage(response);
        },
        error: function(xhr, status, error) {
          console.error(xhr.responseText);
        }
      });
    });

    // Delete Button
    $(document).on('click', '.delete-button', function() {
      var messageId = $(this).data('message-id');
      $.ajax({
        url: '/messages/' + messageId,
        method: 'DELETE',
        headers: {
          'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
        },
        dataType: 'json',
        success: function(response) {
          console.log(response);
          removeMessage(messageId);
        },
        error: function(xhr, status, error) {
          console.error(xhr.responseText);
        }
      });
    });

    function appendMessage(message) {
      var newRow = '<tr id="message_' + message.id + '">' +
                   '<td>' + ($('#messages_table tbody tr').length + 1) + '</td>' +
                   '<td>' + message.content + '</td>' +
                   '<td>' +
                   '<button class="delete-button" data-message-id="' + message.id + '">Delete</button>' +
                   '</td>' +
                   '</tr>';
      $('#messages_table tbody').append(newRow);
    }

    function removeMessage(messageId) {
      $('#message_' + messageId).remove();
      // Update the Sl. No. column after deletion
      $('#messages_table tbody tr').each(function(index) {
        $(this).find('td:first').text(index + 1);
      });
    }
  });
</script>
